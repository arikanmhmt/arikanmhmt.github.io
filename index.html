<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adblock Rule Manager</title>
    <style>
        /* Styling code remains the same */
        /* No changes to the CSS styles */
    </style>
</head>
<body>
    <div id="importExportMenu" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeImportExportMenu()">&times;</span>
            <h2>Import/Export Rules</h2>
            <textarea id="bulkRules" placeholder="Paste multiple rules here..."></textarea>
            <div class="button-group">
                <button onclick="importRules()">Import Rules</button>
                <button onclick="exportRules()">Export Rules</button>
            </div>
        </div>
    </div>

    <div class="user-info">
        <button class="menu-button" onclick="showImportExportMenu()">arikanmhmt &#9662;</button>
        <div class="user-details">
            <div class="user-time" id="currentDateTime"></div>
        </div>
    </div>

    <input type="text" id="searchBar" class="search-bar" placeholder="Search rules...">

    <div class="dashboard">
        <div class="stat-card">
            <div class="stat-title">Total Rules</div>
            <div class="stat-value" id="totalRules">0</div>
            <div class="stat-trend" id="rulesTrend">
                <span>0% this session</span>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-title">Session Duration</div>
            <div class="stat-value" id="sessionDuration">0m</div>
            <div class="stat-trend">Active</div>
        </div>

        <div class="stat-card">
            <div class="stat-title">Duplicate Attempts</div>
            <div class="stat-value" id="duplicateCount">0</div>
            <div class="stat-trend" style="color: var(--warning)">Prevented</div>
        </div>
    </div>

    <div class="card">
        <h2>Current Rules</h2>
        <div id="rules"></div>
    </div>

    <div class="fab" onclick="showAddRuleModal()">+</div>

    <div id="addRuleModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAddRuleModal()">&times;</span>
            <h2>Add New Rule</h2>
            <textarea id="ruleInput" placeholder="Enter domain or Adblock Plus rule here..."></textarea>
            <div id="duplicateWarning" class="duplicate-warning">This rule already exists!</div>
            <div class="button-group">
                <button onclick="addRule()">Add Rule</button>
                <button onclick="validateRule()">Validate Rule</button>
            </div>
        </div>
    </div>

    <script>
        let rules = [];
        let duplicateCount = 0;
        const startTime = new Date();
        const initialRuleCount = 0;

        function updateDateTime() {
            const now = new Date();
            document.getElementById('currentDateTime').textContent = 
                `UTC: ${now.toISOString().replace('T', ' ').slice(0, 19)}`;
        }

        function updateSessionDuration() {
            const now = new Date();
            const diff = Math.floor((now - startTime) / 1000 / 60);
            document.getElementById('sessionDuration').textContent = 
                diff < 60 ? `${diff}m` : `${Math.floor(diff / 60)}h ${diff % 60}m`;
        }

        function updateDashboard() {
            document.getElementById('totalRules').textContent = rules.length;
            document.getElementById('duplicateCount').textContent = duplicateCount;
            
            const trend = initialRuleCount > 0 
                ? ((rules.length - initialRuleCount) / initialRuleCount * 100).toFixed(1)
                : 0;
            document.getElementById('rulesTrend').innerHTML = `
                <span>${trend}% this session</span>
            `;
        }

        function isDuplicate(rule) {
            return rules.includes(rule);
        }

        function addRule() {
            const ruleInput = document.getElementById('ruleInput');
            const rule = ruleInput.value.trim();
            const duplicateWarning = document.getElementById('duplicateWarning');
            
            if (rule) {
                if (isDuplicate(rule)) {
                    duplicateCount++;
                    duplicateWarning.style.display = 'block';
                    setTimeout(() => {
                        duplicateWarning.style.display = 'none';
                    }, 3000);
                } else {
                    rules.push(rule);
                    ruleInput.value = '';
                    duplicateWarning.style.display = 'none';
                    updateRuleDisplay();
                    saveRules();
                }
                updateDashboard();
            }
            closeAddRuleModal();
        }

        function validateRule() {
            const rule = document.getElementById('ruleInput').value.trim();
            if (rule.startsWith('||') || rule.startsWith('##') || rule.includes('##')) {
                alert('✅ Rule format appears valid');
            } else {
                alert('❌ Invalid rule format');
            }
        }

        function importRules() {
            const bulkRules = document.getElementById('bulkRules').value;
            const newRules = bulkRules.split('\n')
                .map(rule => rule.trim())
                .filter(rule => rule && !isDuplicate(rule));
            
            duplicateCount += bulkRules.split('\n')
                .filter(rule => rule.trim() && isDuplicate(rule.trim())).length;
            
            rules = rules.concat(newRules);
            updateRuleDisplay();
            document.getElementById('bulkRules').value = '';
            updateDashboard();
            saveRules();
            closeImportExportMenu();
        }

        function exportRules() {
            document.getElementById('bulkRules').value = rules.join('\n');
        }

        function deleteRule(index) {
            rules.splice(index, 1);
            updateRuleDisplay();
            updateDashboard();
            saveRules();
        }

        function updateRuleDisplay() {
            const rulesDiv = document.getElementById('rules');
            const searchQuery = document.getElementById('searchBar').value.toLowerCase();
            
            if (rules.length === 0) {
                rulesDiv.innerHTML = '<p style="text-align: center; opacity: 0.6;">No rules added yet</p>';
                return;
            }

            // Extract domains and filter based on search query
            const filteredRules = rules.map(rule => extractDomain(rule))
                                        .filter(rule => rule.toLowerCase().includes(searchQuery))
                                        .sort(); // Sort alphabetically

            rulesDiv.innerHTML = filteredRules.map((rule, index) => `
                <div class="rule-item">
                    <div class="rule-text">${rule}</div>
                    <button class="danger" onclick="deleteRule(${rules.indexOf(rule)})">Delete</button>
                </div>
            `).join('');
        }

        function extractDomain(rule) {
            // Extract domain part from the rule (assumes format like '||example.com')
            const match = rule.match(/^\|\|([^\/]+)(\/|$)/);
            return match ? match[1] : rule; // If no match, return the rule as it is
        }

        function saveRules() {
            localStorage.setItem('adblockRules', JSON.stringify(rules));
            localStorage.setItem('duplicateCount', duplicateCount.toString());
        }

        function loadRules() {
            const savedRules = localStorage.getItem('adblockRules');
            const savedDuplicateCount = localStorage.getItem('duplicateCount');
            
            if (savedRules) {
                rules = JSON.parse(savedRules);
                updateRuleDisplay();
            }
            
            if (savedDuplicateCount) {
                duplicateCount = parseInt(savedDuplicateCount);
            }
            
            updateDashboard();
        }

        function showAddRuleModal() {
            document.getElementById('addRuleModal').style.display = 'block';
        }

        function closeAddRuleModal() {
            document.getElementById('addRuleModal').style.display = 'none';
        }

        function showImportExportMenu() {
            document.getElementById('importExportMenu').style.display = 'block';
        }

        function closeImportExportMenu() {
            document.getElementById('importExportMenu').style.display = 'none';
        }

        // Initialize
        function initialize() {
            loadRules();
            updateDateTime();
            setInterval(updateDateTime, 1000);
            setInterval(updateSessionDuration, 60000);
            updateSessionDuration();
            updateRuleDisplay();
        }

        // Arama işlevselliği için event listener
        document.getElementById('searchBar').addEventListener('input', updateRuleDisplay);

        // Sayfa yüklendiğinde initialize fonksiyonunu çağır
        window.onload = initialize;
    </script>
</body>
</html>
